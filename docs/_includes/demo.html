<div class="aura-demo-wrapper">
    <section class="demo-section">
        <div class="container">
            <div class="header">
                <h1>âš¡ AURA-MF Interactive Demo</h1>
                <p>Adaptive Unified Radiative Analysis - Multi-Fidelity Framework</p>
                <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
                    Low-Fidelity 25Ã—25 Resolution Demo
                </p>
            </div>
            
            <div class="content">
                <div class="controls">
                    <h2 style="color: #2c3e50; margin-bottom: 25px;">Simulation Parameters</h2>
                    
                    <div class="parameter-group">
                        <label>Solar Irradiance <span class="parameter-value" id="solar-value">1000</span> W/mÂ²</label>
                        <input type="range" id="solar-irradiance" min="800" max="1200" value="1000" step="10">
                        <div class="param-info">Incident solar radiation on panel surface</div>
                    </div>

                    <div class="parameter-group">
                        <label>Ambient Temperature <span class="parameter-value" id="temp-value">27</span> Â°C</label>
                        <input type="range" id="ambient-temperature" min="280" max="330" value="300" step="1">
                        <div class="param-info">Surrounding air temperature</div>
                    </div>

                    <div class="parameter-group">
                        <label>Wind Speed <span class="parameter-value" id="wind-value">1.0</span> m/s</label>
                        <input type="range" id="wind-speed" min="0" max="10" value="1" step="0.1">
                        <div class="param-info">Affects convective cooling rate</div>
                    </div>

                    <div class="parameter-group">
                        <label>Cell Efficiency <span class="parameter-value" id="efficiency-value">20</span> %</label>
                        <input type="range" id="cell-efficiency" min="0.10" max="0.30" value="0.20" step="0.01">
                        <div class="param-info">Base electrical conversion efficiency</div>
                    </div>

                    <div class="parameter-group">
                        <label>Thermal Conductivity <span class="parameter-value" id="conductivity-value">130</span> W/(mÂ·K)</label>
                        <input type="range" id="thermal-conductivity" min="100" max="200" value="130" step="5">
                        <div class="param-info">In-plane heat conduction</div>
                    </div>

                    <div class="parameter-group">
                        <label>Absorptivity <span class="parameter-value" id="absorptivity-value">0.95</span></label>
                        <input type="range" id="absorptivity" min="0.85" max="0.98" value="0.95" step="0.01">
                        <div class="param-info">Fraction of incident solar radiation absorbed</div>
                    </div>

                    <div class="parameter-group">
                        <label>Emissivity <span class="parameter-value" id="emissivity-value">0.90</span></label>
                        <input type="range" id="emissivity" min="0.80" max="0.95" value="0.90" step="0.01">
                        <div class="param-info">Radiative heat loss efficiency</div>
                    </div>

                    <button class="run-button" id="run-button" onclick="runSimulation()">ðŸš€ Run Simulation</button>
                    <button class="reset-button" onclick="resetParameters()">â†º Reset to Defaults</button>
                </div>
                
                <div class="visualization">
                    <div class="error" id="error-message"></div>
                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p>Running simulation...</p>
                    </div>
                    
                    <div id="results-container" style="display: none; width: 100%;">
                        <img id="visualization-image" src="" alt="Simulation Results">
                        <div class="results">
                            <h3>ðŸ“Š Simulation Results</h3>
                            <div class="result-grid">
                                <div class="result-item"><label>Mean Temp</label><div class="value" id="temp-mean">-</div></div>
                                <div class="result-item"><label>Max Temp</label><div class="value" id="temp-max">-</div></div>
                                <div class="result-item"><label>Total Power</label><div class="value" id="power-total">-</div></div>
                                <div class="result-item"><label>Avg Efficiency</label><div class="value" id="efficiency-avg">-</div></div>
                            </div>
                            <div style="margin-top: 15px; text-align: center; color: #6c757d; font-size: 0.9em;">
                                Computation time: <span id="runtime">-</span> ms
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <iframe 
        id="backend-bridge" 
        src="https://thmscmpg.github.io/backend-hub/" 
        style="display:none; width:0; height:0; border:0;">
    </iframe>
    
    <style>
        /* Scope everything to this specific container */
        .aura-demo-wrapper {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            /* If you want the gradient background only behind the demo: */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
        }

        .aura-demo-wrapper * {
            box-sizing: border-box;
        }

        .aura-demo-wrapper .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            color: #333; /* Reset color in case site is dark mode */
        }

        .aura-demo-wrapper .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .aura-demo-wrapper .header h1 { color: white; margin: 0; }

        .aura-demo-wrapper .content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
        }

        .aura-demo-wrapper .controls {
            background: #f8f9fa;
            padding: 25px;
            border-right: 1px solid #dee2e6;
        }

        .aura-demo-wrapper .parameter-group { margin-bottom: 20px; }
        .aura-demo-wrapper .parameter-group label { display: block; font-weight: 600; margin-bottom: 8px; }
        .aura-demo-wrapper .parameter-value { color: #667eea; font-weight: 700; float: right; }
        
        /* Slider styling scoped */
        .aura-demo-wrapper input[type="range"] { width: 100%; }

        .aura-demo-wrapper .run-button {
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 8px;
            font-weight: 700; cursor: pointer;
        }

        .aura-demo-wrapper .visualization { padding: 30px; display: flex; flex-direction: column; align-items: center; background: #fff; }

        .aura-demo-wrapper .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .aura-demo-wrapper .result-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; }

        .aura-demo-wrapper .loading { display: none; text-align: center; }
        .aura-demo-wrapper .loading.active { display: block; }
        
        .aura-demo-wrapper .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #667eea;
            border-radius: 50%; width: 40px; height: 40px;
            animation: aura-spin 1s linear infinite; margin: 0 auto;
        }

        @keyframes aura-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 900px) {
            .aura-demo-wrapper .content { grid-template-columns: 1fr; }
        }
    </style>
</div>


    <script>
        // Update slider value displays
        const sliders = [
            {id: 'solar-irradiance', display: 'solar-value', format: v => v},
            {id: 'ambient-temperature', display: 'temp-value', format: v => (v - 273.15).toFixed(1)},
            {id: 'wind-speed', display: 'wind-value', format: v => parseFloat(v).toFixed(1)},
            {id: 'cell-efficiency', display: 'efficiency-value', format: v => (v * 100).toFixed(0)},
            {id: 'thermal-conductivity', display: 'conductivity-value', format: v => v},
            {id: 'absorptivity', display: 'absorptivity-value', format: v => parseFloat(v).toFixed(2)},
            {id: 'emissivity', display: 'emissivity-value', format: v => parseFloat(v).toFixed(2)}
        ];
        
        sliders.forEach(slider => {
            const element = document.getElementById(slider.id);
            const display = document.getElementById(slider.display);
            
            element.addEventListener('input', function() {
                display.textContent = slider.format(this.value);
            });
        });
        
        async function runSimulation() {
            // Collect parameters
            const params = {
                solar_irradiance: parseFloat(document.getElementById('solar-irradiance').value),
                ambient_temperature: parseFloat(document.getElementById('ambient-temperature').value),
                wind_speed: parseFloat(document.getElementById('wind-speed').value),
                cell_efficiency: parseFloat(document.getElementById('cell-efficiency').value),
                thermal_conductivity: parseFloat(document.getElementById('thermal-conductivity').value),
                absorptivity: parseFloat(document.getElementById('absorptivity').value),
                emissivity: parseFloat(document.getElementById('emissivity').value)
            };
            
            // Show loading, hide results and errors
            document.getElementById('loading').classList.add('active');
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('error-message').classList.remove('active');
            document.getElementById('run-button').disabled = true;
            
            try {
                const response = await fetch('/api/simulate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(params)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Simulation failed');
                }
                
                // Display results
                displayResults(data);
                
            } catch (error) {
                document.getElementById('error-message').textContent = 
                    'âŒ Error: ' + error.message;
                document.getElementById('error-message').classList.add('active');
            } finally {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('run-button').disabled = false;
            }
        }
        
        function displayResults(data) {
            const results = data.results;
            
            // Show visualization
            document.getElementById('visualization-image').src = 
                'data:image/png;base64,' + data.visualization;
            
            // Update result values
            document.getElementById('temp-mean').textContent = 
                (results.temperature_mean - 273.15).toFixed(1) + ' Â°C';
            document.getElementById('temp-max').textContent = 
                (results.temperature_max - 273.15).toFixed(1) + ' Â°C';
            document.getElementById('power-total').textContent = 
                results.power_total.toFixed(2) + ' W';
            document.getElementById('efficiency-avg').textContent = 
                (results.efficiency_avg * 100).toFixed(1) + ' %';
            document.getElementById('runtime').textContent = 
                results.runtime_ms.toFixed(1);
            
            // Show results
            document.getElementById('results-container').style.display = 'block';
        }
        
        function resetParameters() {
            document.getElementById('solar-irradiance').value = 1000;
            document.getElementById('ambient-temperature').value = 300;
            document.getElementById('wind-speed').value = 1;
            document.getElementById('cell-efficiency').value = 0.20;
            document.getElementById('thermal-conductivity').value = 130;
            document.getElementById('absorptivity').value = 0.95;
            document.getElementById('emissivity').value = 0.90;
            
            // Trigger input events to update displays
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                element.dispatchEvent(new Event('input'));
            });
        }
        
        // Initialize displays
        window.addEventListener('load', () => {
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                element.dispatchEvent(new Event('input'));
            });
        });
    </script>
